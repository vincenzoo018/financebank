@inherits LayoutComponentBase
@inject AuthService AuthService
@inject NavigationManager Navigation

<div class="sidebar-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div style="text-align: center;">
                <img src="images/finsys-logo.png" alt="FINSYS Logo" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.15);" />
                <div class="sidebar-logo">FINSYS Admin</div>
                <div class="sidebar-subtitle">Finance System</div>
            </div>
        </div>

        <div class="sidebar-nav" style="overflow-y: auto; max-height: calc(100vh - 200px);">
            <!-- Main Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">MAIN</div>
                <a href="/admin/dashboard" class="sidebar-item @(IsActive("/admin/dashboard"))">
                    <span>ğŸ </span>
                    <span>Dashboard</span>
                </a>
            </div>

            @* SuperAdmin Only - User Management *@
            @if (currentRole == AuthService.Roles.SuperAdmin)
            {
                <div class="sidebar-section">
                    <div class="sidebar-section-title">USER MANAGEMENT</div>
                    <div class="sidebar-dropdown @(userMgmtOpen ? "open" : "")">
                        <button class="sidebar-dropdown-toggle" @onclick="() => userMgmtOpen = !userMgmtOpen">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span>ğŸ‘¥</span>
                                <span>Users & Roles</span>
                            </div>
                            <span class="dropdown-arrow">â–¼</span>
                        </button>
                        <div class="sidebar-dropdown-menu">
                            <a href="/admin/user-registration" class="sidebar-dropdown-item @(IsActive("/admin/user-registration"))">â• Register New User</a>
                            <a href="/admin/users" class="sidebar-dropdown-item @(IsActive("/admin/users"))">ğŸ“‹ All Users</a>
                            <a href="/admin/roles" class="sidebar-dropdown-item @(IsActive("/admin/roles"))">ğŸ” Roles & Permissions</a>
                            <a href="/admin/customers" class="sidebar-dropdown-item @(IsActive("/admin/customers"))">ğŸ‘¤ Customer Profiles</a>
                        </div>
                    </div>
                </div>
            }

            @* SuperAdmin Only - Transaction Approvals (List/Confirmation pages) *@
            @if (currentRole == AuthService.Roles.SuperAdmin)
            {
                <div class="sidebar-section">
                    <div class="sidebar-section-title">TRANSACTION APPROVALS</div>
                    <div class="sidebar-dropdown @(transactionsOpen ? "open" : "")">
                        <button class="sidebar-dropdown-toggle" @onclick="() => transactionsOpen = !transactionsOpen">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span>âœ…</span>
                                <span>Approve Transactions</span>
                            </div>
                            <span class="dropdown-arrow">â–¼</span>
                        </button>
                        <div class="sidebar-dropdown-menu">
                            <a href="/admin/approvals/deposits" class="sidebar-dropdown-item @(IsActive("/admin/approvals/deposits"))">ğŸ’° Deposit Approvals</a>
                            <a href="/admin/approvals/withdrawals" class="sidebar-dropdown-item @(IsActive("/admin/approvals/withdrawals"))">ğŸ’¸ Withdrawal Approvals</a>
                            <a href="/admin/approvals/transfers" class="sidebar-dropdown-item @(IsActive("/admin/approvals/transfers"))">ğŸ”„ Transfer Approvals</a>
                            <a href="/admin/transactions/loan" class="sidebar-dropdown-item @(IsActive("/admin/transactions/loan"))">ğŸ¦ Loan Applications</a>
                            <a href="/admin/transactions/bills" class="sidebar-dropdown-item @(IsActive("/admin/transactions/bills"))">ğŸ“„ Bill Payments</a>
                            <a href="/admin/transactions/cards" class="sidebar-dropdown-item @(IsActive("/admin/transactions/cards"))">ğŸ’³ Card Transactions</a>
                            <a href="/admin/transactions" class="sidebar-dropdown-item @(IsActive("/admin/transactions"))">ğŸ“Š All Transactions</a>
                        </div>
                    </div>
                </div>
            }

            @* Banking - Accountant & SuperAdmin *@
            @if (currentRole == AuthService.Roles.SuperAdmin || currentRole == AuthService.Roles.Accountant)
            {
                <div class="sidebar-section">
                    <div class="sidebar-section-title">BANKING</div>
                    <div class="sidebar-dropdown @(bankingOpen ? "open" : "")">
                        <button class="sidebar-dropdown-toggle" @onclick="() => bankingOpen = !bankingOpen">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span>ğŸ¦</span>
                                <span>Banking</span>
                            </div>
                            <span class="dropdown-arrow">â–¼</span>
                        </button>
                        <div class="sidebar-dropdown-menu">
                            <a href="/admin/banking/accounts" class="sidebar-dropdown-item @(IsActive("/admin/banking/accounts"))">ğŸ’¼ Bank Accounts</a>
                            <a href="/admin/banking/transfers" class="sidebar-dropdown-item @(IsActive("/admin/banking/transfers"))">ğŸ”„ Fund Transfers</a>
                            <a href="/admin/banking/billers" class="sidebar-dropdown-item @(IsActive("/admin/banking/billers"))">ğŸ“ Billers Management</a>
                            <a href="/admin/banking/loans" class="sidebar-dropdown-item @(IsActive("/admin/banking/loans"))">ğŸ¦ Loans Management</a>
                        </div>
                    </div>
                </div>
            }

            @* Accounting - Accountant & SuperAdmin *@
            @if (currentRole == AuthService.Roles.SuperAdmin || currentRole == AuthService.Roles.Accountant)
            {
                <div class="sidebar-section">
                    <div class="sidebar-section-title">ACCOUNTING</div>
                    <div class="sidebar-dropdown @(accountingOpen ? "open" : "")">
                        <button class="sidebar-dropdown-toggle" @onclick="() => accountingOpen = !accountingOpen">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span>ğŸ“Š</span>
                                <span>Accounting</span>
                            </div>
                            <span class="dropdown-arrow">â–¼</span>
                        </button>
                        <div class="sidebar-dropdown-menu">
                            <a href="/admin/accounting/journal" class="sidebar-dropdown-item @(IsActive("/admin/accounting/journal"))">ğŸ“– Journal Entries</a>
                            <a href="/admin/accounting/ledger" class="sidebar-dropdown-item @(IsActive("/admin/accounting/ledger"))">ğŸ“— General Ledger</a>
                            <a href="/admin/accounting/trial-balance" class="sidebar-dropdown-item @(IsActive("/admin/accounting/trial-balance"))">âš–ï¸ Trial Balance</a>
                            <a href="/admin/accounting/statements" class="sidebar-dropdown-item @(IsActive("/admin/accounting/statements"))">ğŸ“„ Financial Statements</a>
                            <a href="/admin/accounting/chart-of-accounts" class="sidebar-dropdown-item @(IsActive("/admin/accounting/chart-of-accounts"))">ğŸ“‘ Chart of Accounts</a>
                        </div>
                    </div>
                </div>
            }

            @* Finance - Finance Manager & SuperAdmin *@
            @if (currentRole == AuthService.Roles.SuperAdmin || currentRole == AuthService.Roles.FinanceManager)
            {
                <div class="sidebar-section">
                    <div class="sidebar-section-title">FINANCE</div>
                    <div class="sidebar-dropdown @(financeOpen ? "open" : "")">
                        <button class="sidebar-dropdown-toggle" @onclick="() => financeOpen = !financeOpen">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span>ğŸ’µ</span>
                                <span>Finance</span>
                            </div>
                            <span class="dropdown-arrow">â–¼</span>
                        </button>
                        <div class="sidebar-dropdown-menu">
                            <a href="/admin/finance/payables" class="sidebar-dropdown-item @(IsActive("/admin/finance/payables"))">ğŸ’° Accounts Payable</a>
                            <a href="/admin/finance/receivables" class="sidebar-dropdown-item @(IsActive("/admin/finance/receivables"))">ğŸ’³ Accounts Receivable</a>
                            <a href="/admin/finance/budgets" class="sidebar-dropdown-item @(IsActive("/admin/finance/budgets"))">ğŸ“Š Budget Management</a>
                            <a href="/admin/finance/forecasting" class="sidebar-dropdown-item @(IsActive("/admin/finance/forecasting"))">ğŸ“ˆ Financial Forecasting</a>
                            <a href="/admin/finance/cash-flow" class="sidebar-dropdown-item @(IsActive("/admin/finance/cash-flow"))">ğŸ’¸ Cash Flow Analysis</a>
                        </div>
                    </div>
                </div>
            }

            @* Security - SuperAdmin Only *@
            @if (currentRole == AuthService.Roles.SuperAdmin)
            {
                <div class="sidebar-section">
                    <div class="sidebar-section-title">SECURITY</div>
                    <div class="sidebar-dropdown @(securityOpen ? "open" : "")">
                        <button class="sidebar-dropdown-toggle" @onclick="() => securityOpen = !securityOpen">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span>ğŸ”’</span>
                                <span>Security</span>
                            </div>
                            <span class="dropdown-arrow">â–¼</span>
                        </button>
                        <div class="sidebar-dropdown-menu">
                            <a href="/admin/security" class="sidebar-dropdown-item @(IsActive("/admin/security"))">ğŸ” Security Center</a>
                            <a href="/admin/login-history" class="sidebar-dropdown-item @(IsActive("/admin/login-history"))">ğŸ“œ Login History</a>
                            <a href="/admin/sessions" class="sidebar-dropdown-item @(IsActive("/admin/sessions"))">ğŸ“± Session Management</a>
                            <a href="/admin/audit-trail" class="sidebar-dropdown-item @(IsActive("/admin/audit-trail"))">ğŸ“‹ Audit Trail</a>
                        </div>
                    </div>
                </div>
            }

            @* System - All Roles *@
            <div class="sidebar-section">
                <div class="sidebar-section-title">SYSTEM</div>
                <a href="/admin/reports" class="sidebar-item @(IsActive("/admin/reports"))">
                    <span>ğŸ“ˆ</span>
                    <span>Reports</span>
                </a>
                @if (currentRole == AuthService.Roles.SuperAdmin)
                {
                    <a href="/admin/settings" class="sidebar-item @(IsActive("/admin/settings"))">
                        <span>âš™ï¸</span>
                        <span>Settings</span>
                    </a>
                }
            </div>
        </div>

        <div class="sidebar-footer">
            <div class="sidebar-user" @onclick="HandleLogout">
                <div class="sidebar-user-avatar">AD</div>
                <div class="sidebar-user-info">
                    <h4>Admin User</h4>
                    <p>Logout</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="sidebar-main">
        <div class="sidebar-topbar">
            <div class="topbar-title">@GetPageTitle()</div>
        </div>
        <div class="sidebar-content">
            @Body
        </div>
    </div>
</div>

@code {
    private bool userMgmtOpen = false;
    private bool transactionsOpen = true;
    private bool bankingOpen = false;
    private bool securityOpen = false;
    private bool financeOpen = false;
    private bool accountingOpen = false;
    
    private string currentRole = "";

    protected override void OnInitialized()
    {
        currentRole = AuthService.CurrentRole ?? string.Empty;
    }

    private string IsActive(string path)
    {
        return Navigation.Uri.Contains(path) ? "active" : "";
    }

    private string GetPageTitle()
    {
        var path = Navigation.Uri;
        if (path.Contains("/dashboard")) return "Dashboard";
        if (path.Contains("/users")) return "User Management";
        if (path.Contains("/accounts") || path.Contains("/banking")) return "Banking";
        if (path.Contains("/accounting")) return "Accounting";
        if (path.Contains("/finance")) return "Finance";
        if (path.Contains("/transactions") || path.Contains("/approvals")) return "Transactions";
        if (path.Contains("/reports")) return "Reports";
        if (path.Contains("/settings")) return "Settings";
        return "Admin Panel";
    }

    private void HandleLogout()
    {
        AuthService.Logout();
        Navigation.NavigateTo("/login");
    }
}

