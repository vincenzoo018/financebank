@page "/employee/approvals"
@layout EmployeeLayout

<div style="padding: 24px; max-width: 1400px; margin: 0 auto;">
    <!-- Header -->
    <div style="background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 16px; padding: 24px; margin-bottom: 24px; color: white;">
        <div style="display: flex; align-items: center; gap: 16px;">
            <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </div>
            <div style="flex: 1;">
                <h1 style="font-size: 24px; font-weight: 700; margin: 0;">Approval Queue</h1>
                <p style="margin: 4px 0 0; opacity: 0.9; font-size: 14px;">Review and process pending approvals</p>
            </div>
            <div style="background: rgba(255,255,255,0.2); padding: 10px 16px; border-radius: 8px;">
                <div style="font-size: 11px; opacity: 0.9;">Queue Size</div>
                <div style="font-size: 20px; font-weight: 700;">@approvalItems.Count</div>
            </div>
        </div>
    </div>

    <!-- Filter Bar -->
    <div style="background: white; border-radius: 12px; padding: 16px; margin-bottom: 24px; border: 1px solid #e5e7eb;">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
            <div>
                <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 6px; color: #6b7280;">Department</label>
                <select style="width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                    <option>All Departments</option>
                    <option>Operations</option>
                    <option>Loans</option>
                    <option>Accounts</option>
                    <option>Cards</option>
                </select>
            </div>
            <div>
                <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 6px; color: #6b7280;">Type</label>
                <select style="width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                    <option>All Types</option>
                    <option>Deposit</option>
                    <option>Withdrawal</option>
                    <option>Transfer</option>
                    <option>Loan</option>
                </select>
            </div>
            <div>
                <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 6px; color: #6b7280;">Priority</label>
                <select style="width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                    <option>All Priorities</option>
                    <option>High</option>
                    <option>Medium</option>
                    <option>Low</option>
                </select>
            </div>
            <div style="display: flex; align-items: flex-end;">
                <button style="width: 100%; padding: 8px; background: #f59e0b; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">Apply Filters</button>
            </div>
        </div>
    </div>

    <!-- Approval Items -->
    <div style="background: white; border-radius: 16px; padding: 24px; border: 1px solid #e5e7eb;">
        <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 20px;">Pending Approvals (@approvalItems.Count)</h3>
        
        <div style="display: grid; gap: 16px;">
            @foreach (var item in approvalItems)
            {
                <div style="border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; transition: all 0.2s; hover: box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <span style='padding: 4px 8px; background: @GetTypeColor(item.Type); border-radius: 6px; font-size: 11px; font-weight: 600; color: white;'>@item.Type</span>
                                <span style='padding: 4px 8px; background: @GetPriorityColor(item.Priority); border-radius: 6px; font-size: 11px; font-weight: 600;'>@item.Priority</span>
                            </div>
                            <h4 style="font-size: 16px; font-weight: 700; margin-bottom: 4px;">@item.Type Request - @item.CustomerName</h4>
                            <p style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">@item.Description</p>
                            <div style="display: flex; gap: 16px; font-size: 12px; color: #9ca3af;">
                                <span>ID: @item.Id</span>
                                <span>Customer: @item.CustomerName</span>
                                <span>Submitted: @item.SubmittedDate.ToString("MMM dd, yyyy")</span>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 18px; font-weight: 700; color: #f59e0b; margin-bottom: 8px;">₱@item.Amount.ToString("N2")</div>
                            <button @onclick="() => ShowApprovalModal(item)" style="background: #f59e0b; color: white; padding: 8px 16px; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer;">Review</button>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<!-- Approval Modal -->
@if (showApprovalModal && selectedItem != null)
{
    <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 9999;" @onclick="CloseApprovalModal">
        <div style="background: white; border-radius: 16px; padding: 32px; max-width: 600px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);" @onclick:stopPropagation>
            <div style="text-align: center; margin-bottom: 24px;">
                <div style="width: 64px; height: 64px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center;">
                    <svg width="32" height="32" fill="none" stroke="white" stroke-width="2">
                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <h2 style="font-size: 20px; font-weight: 700; margin: 0;">Review @selectedItem.Type Request</h2>
                <p style="font-size: 14px; color: #6b7280; margin-top: 4px;">@selectedItem.Priority Priority - Department: @selectedItem.Department</p>
            </div>

            <div style="background: #f9fafb; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div>
                        <div style="font-size: 11px; color: #6b7280; margin-bottom: 4px;">Request ID</div>
                        <div style="font-weight: 600;">@selectedItem.Id</div>
                    </div>
                    <div>
                        <div style="font-size: 11px; color: #6b7280; margin-bottom: 4px;">Submitted</div>
                        <div style="font-weight: 600;">@selectedItem.SubmittedDate.ToString("MMM dd, yyyy")</div>
                    </div>
                    <div>
                        <div style="font-size: 11px; color: #6b7280; margin-bottom: 4px;">Customer</div>
                        <div style="font-weight: 600;">@selectedItem.CustomerName</div>
                    </div>
                    <div>
                        <div style="font-size: 11px; color: #6b7280; margin-bottom: 4px;">Amount</div>
                        <div style="font-size: 18px; font-weight: 700; color: #f59e0b;">₱@selectedItem.Amount.ToString("N2")</div>
                    </div>
                </div>
                <div style="margin-top: 16px;">
                    <div style="font-size: 11px; color: #6b7280; margin-bottom: 4px;">Description</div>
                    <div style="font-weight: 600;">@selectedItem.Description</div>
                </div>
            </div>

            <div style="margin-bottom: 24px;">
                <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 8px;">Employee Comments</label>
                <textarea @bind="approvalComments" style="width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; resize: vertical;" rows="3" placeholder="Add your comments for this review..."></textarea>
            </div>

            <div style="display: flex; gap: 12px;">
                <button @onclick="CloseApprovalModal" style="flex: 1; padding: 12px; background: #f3f4f6; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Cancel</button>
                <button style="flex: 1; padding: 12px; background: #dc2626; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Reject</button>
                <button style="flex: 1; padding: 12px; background: #059669; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Approve</button>
            </div>
        </div>
    </div>
}

@code {
    private List<ApprovalItem> approvalItems = new();
    private bool showApprovalModal = false;
    private ApprovalItem? selectedItem = null;
    private string approvalComments = "";

    protected override void OnInitialized()
    {
        approvalItems = new List<ApprovalItem>
        {
            new() { Id = "REQ-001", Type = "Deposit", Priority = "High", Description = "Large cash deposit verification required", CustomerName = "Juan Dela Cruz", Amount = 50000, SubmittedDate = DateTime.Now.AddHours(-2), Department = "Operations" },
            new() { Id = "REQ-002", Type = "Loan", Priority = "Medium", Description = "Personal loan application - income verification", CustomerName = "Maria Santos", Amount = 100000, SubmittedDate = DateTime.Now.AddHours(-5), Department = "Loans" },
            new() { Id = "REQ-003", Type = "Transfer", Priority = "High", Description = "International transfer - compliance check", CustomerName = "Pedro Reyes", Amount = 75000, SubmittedDate = DateTime.Now.AddHours(-1), Department = "Operations" },
            new() { Id = "REQ-004", Type = "Card", Priority = "Low", Description = "Credit card application review", CustomerName = "Ana Garcia", Amount = 0, SubmittedDate = DateTime.Now.AddHours(-3), Department = "Cards" },
        };
    }

    private void ShowApprovalModal(ApprovalItem item)
    {
        selectedItem = item;
        showApprovalModal = true;
    }

    private void CloseApprovalModal()
    {
        showApprovalModal = false;
        selectedItem = null;
        approvalComments = "";
    }

    private string GetTypeColor(string type)
    {
        return type switch
        {
            "Deposit" => "#059669",
            "Withdrawal" => "#dc2626",
            "Transfer" => "#0891b2",
            "Loan" => "#7c3aed",
            "Card" => "#f59e0b",
            _ => "#6b7280"
        };
    }

    private string GetPriorityColor(string priority)
    {
        return priority switch
        {
            "High" => "#fee2e2",
            "Medium" => "#fef3c7",
            "Low" => "#dbeafe",
            _ => "#f3f4f6"
        };
    }

    private class ApprovalItem
    {
        public string Id { get; set; } = "";
        public string Type { get; set; } = "";
        public string Priority { get; set; } = "";
        public string Description { get; set; } = "";
        public string CustomerName { get; set; } = "";
        public decimal Amount { get; set; }
        public DateTime SubmittedDate { get; set; }
        public string Department { get; set; } = "";
    }
}
