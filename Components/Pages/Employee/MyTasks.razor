@page "/employee/tasks"
@layout EmployeeLayout

<div style="padding: 24px; max-width: 1400px; margin: 0 auto;">
    <!-- Header -->
    <div style="background: linear-gradient(135deg, #0891b2, #0e7490); border-radius: 16px; padding: 24px; margin-bottom: 24px; color: white;">
        <div style="display: flex; align-items: center; gap: 16px;">
            <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                </svg>
            </div>
            <div style="flex: 1;">
                <h1 style="font-size: 24px; font-weight: 700; margin: 0;">My Tasks</h1>
                <p style="margin: 4px 0 0; opacity: 0.9; font-size: 14px;">Track and manage your assigned tasks</p>
            </div>
            <div style="background: rgba(255,255,255,0.2); padding: 10px 16px; border-radius: 8px;">
                <div style="font-size: 11px; opacity: 0.9;">Active</div>
                <div style="font-size: 20px; font-weight: 700;">@GetActiveTasks()</div>
            </div>
        </div>
    </div>

    <!-- Stats Bar -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px;">
        <div style="background: white; border-radius: 12px; padding: 16px; border: 2px solid #fef3c7; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #f59e0b;">@tasks.Count(t => t.Status == "Pending")</div>
            <div style="font-size: 12px; color: #6b7280; margin-top: 4px;">Pending</div>
        </div>
        <div style="background: white; border-radius: 12px; padding: 16px; border: 2px solid #dbeafe; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #0891b2;">@tasks.Count(t => t.Status == "In Progress")</div>
            <div style="font-size: 12px; color: #6b7280; margin-top: 4px;">In Progress</div>
        </div>
        <div style="background: white; border-radius: 12px; padding: 16px; border: 2px solid #d1fae5; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #059669;">@tasks.Count(t => t.Status == "Completed")</div>
            <div style="font-size: 12px; color: #6b7280; margin-top: 4px;">Completed</div>
        </div>
        <div style="background: white; border-radius: 12px; padding: 16px; border: 2px solid #fee2e2; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #dc2626;">@tasks.Count(t => t.IsOverdue)</div>
            <div style="font-size: 12px; color: #6b7280; margin-top: 4px;">Overdue</div>
        </div>
    </div>

    <!-- Task Tabs -->
    <div style="background: white; border-radius: 16px; padding: 0; border: 1px solid #e5e7eb; overflow: hidden;">
        <div style="display: flex; border-bottom: 2px solid #e5e7eb;">
            <button @onclick='() => selectedTab = "all"' style='flex: 1; padding: 16px; background: @(selectedTab == "all" ? "#0891b2" : "transparent"); color: @(selectedTab == "all" ? "white" : "#6b7280"); border: none; font-size: 14px; font-weight: 600; cursor: pointer;'>All Tasks (@tasks.Count)</button>
            <button @onclick='() => selectedTab = "pending"' style='flex: 1; padding: 16px; background: @(selectedTab == "pending" ? "#0891b2" : "transparent"); color: @(selectedTab == "pending" ? "white" : "#6b7280"); border: none; font-size: 14px; font-weight: 600; cursor: pointer;'>Pending (@tasks.Count(t => t.Status == "Pending"))</button>
            <button @onclick='() => selectedTab = "progress"' style='flex: 1; padding: 16px; background: @(selectedTab == "progress" ? "#0891b2" : "transparent"); color: @(selectedTab == "progress" ? "white" : "#6b7280"); border: none; font-size: 14px; font-weight: 600; cursor: pointer;'>In Progress (@tasks.Count(t => t.Status == "In Progress"))</button>
            <button @onclick='() => selectedTab = "completed"' style='flex: 1; padding: 16px; background: @(selectedTab == "completed" ? "#0891b2" : "transparent"); color: @(selectedTab == "completed" ? "white" : "#6b7280"); border: none; font-size: 14px; font-weight: 600; cursor: pointer;'>Completed (@tasks.Count(t => t.Status == "Completed"))</button>
        </div>

        <div style="padding: 24px;">
            <div style="display: grid; gap: 16px;">
                @foreach (var task in GetFilteredTasks())
                {
                    <div style="border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; transition: all 0.2s;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <h4 style="font-size: 16px; font-weight: 700; margin: 0;">@task.Title</h4>
                                    @if (task.IsOverdue)
                                    {
                                        <span style="padding: 4px 8px; background: #fee2e2; color: #dc2626; border-radius: 6px; font-size: 11px; font-weight: 600;">OVERDUE</span>
                                    }
                                    <span style='padding: 4px 8px; background: @GetPriorityColor(task.Priority); border-radius: 6px; font-size: 11px; font-weight: 600;'>@task.Priority</span>
                                </div>
                                <p style="font-size: 14px; color: #6b7280; margin-bottom: 12px;">@task.Description</p>
                                <div style="display: flex; gap: 16px; font-size: 12px; color: #9ca3af;">
                                    <span>Due: @task.DueDate.ToString("MMM dd, yyyy")</span>
                                    <span>Assigned: @task.AssignedDate.ToString("MMM dd")</span>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <span style='padding: 6px 12px; background: @GetStatusColor(task.Status); border-radius: 8px; font-size: 12px; font-weight: 600; display: inline-block; margin-bottom: 8px;'>@task.Status</span>
                                @if (task.Status != "Completed")
                                {
                                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                                        @if (task.Status == "Pending")
                                        {
                                            <button @onclick="() => UpdateTaskStatus(task, IN_PROGRESS)" style="padding: 6px 12px; background: #0891b2; color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Start</button>
                                        }
                                        @if (task.Status == "In Progress")
                                        {
                                            <button @onclick="() => UpdateTaskStatus(task, COMPLETED)" style="padding: 6px 12px; background: #059669; color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">Complete</button>
                                        }
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@code {
    private List<TaskItem> tasks = new();
    private string selectedTab = "all";
    private const string IN_PROGRESS = "In Progress";
    private const string COMPLETED = "Completed";

    protected override void OnInitialized()
    {
        tasks = new List<TaskItem>
        {
            new() { Title = "Review Deposit Request", Description = "Verify large deposit from Juan Dela Cruz", Status = "Pending", Priority = "High", DueDate = DateTime.Now.AddDays(1), AssignedDate = DateTime.Now.AddDays(-1), IsOverdue = false },
            new() { Title = "Customer Verification", Description = "Complete KYC for new account opening", Status = "In Progress", Priority = "Medium", DueDate = DateTime.Now.AddDays(2), AssignedDate = DateTime.Now.AddDays(-3), IsOverdue = false },
            new() { Title = "Loan Application Review", Description = "Assess creditworthiness for Maria Santos", Status = "Pending", Priority = "High", DueDate = DateTime.Now.AddDays(-1), AssignedDate = DateTime.Now.AddDays(-5), IsOverdue = true },
            new() { Title = "Account Closure Process", Description = "Process account closure request", Status = "In Progress", Priority = "Low", DueDate = DateTime.Now.AddDays(3), AssignedDate = DateTime.Now.AddDays(-2), IsOverdue = false },
            new() { Title = "Transaction Dispute", Description = "Investigate disputed transaction", Status = "Completed", Priority = "High", DueDate = DateTime.Now.AddDays(-2), AssignedDate = DateTime.Now.AddDays(-7), IsOverdue = false },
            new() { Title = "Document Verification", Description = "Verify submitted documents for Pedro Reyes", Status = "Completed", Priority = "Medium", DueDate = DateTime.Now.AddDays(-3), AssignedDate = DateTime.Now.AddDays(-8), IsOverdue = false },
            new() { Title = "Compliance Check", Description = "International transfer compliance review", Status = "Pending", Priority = "High", DueDate = DateTime.Now.AddHours(6), AssignedDate = DateTime.Now.AddHours(-4), IsOverdue = false },
        };
    }

    private int GetActiveTasks()
    {
        return tasks.Count(t => t.Status == "Pending" || t.Status == "In Progress");
    }

    private List<TaskItem> GetFilteredTasks()
    {
        return selectedTab switch
        {
            "pending" => tasks.Where(t => t.Status == "Pending").ToList(),
            "progress" => tasks.Where(t => t.Status == "In Progress").ToList(),
            "completed" => tasks.Where(t => t.Status == "Completed").ToList(),
            _ => tasks
        };
    }

    private string GetStatusColor(string status)
    {
        return status switch
        {
            "Pending" => "#fef3c7",
            "In Progress" => "#dbeafe",
            "Completed" => "#d1fae5",
            _ => "#f3f4f6"
        };
    }

    private string GetPriorityColor(string priority)
    {
        return priority switch
        {
            "High" => "#fee2e2",
            "Medium" => "#fef3c7",
            "Low" => "#dbeafe",
            _ => "#f3f4f6"
        };
    }

    private void UpdateTaskStatus(TaskItem task, string newStatus)
    {
        task.Status = newStatus;
        StateHasChanged();
    }

    private class TaskItem
    {
        public string Title { get; set; } = "";
        public string Description { get; set; } = "";
        public string Status { get; set; } = "";
        public string Priority { get; set; } = "";
        public DateTime DueDate { get; set; }
        public DateTime AssignedDate { get; set; }
        public bool IsOverdue { get; set; }
    }
}
