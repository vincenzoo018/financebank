@page "/login"
@inject AuthService AuthService
@inject NavigationManager Navigation

<div style="min-height: 100vh; display: flex; background: linear-gradient(135deg, #0f766e 0%, #059669 50%, #10b981 100%); position: relative; overflow: hidden;">
    <!-- Animated Background Elements -->
    <div style="position: absolute; width: 500px; height: 500px; background: rgba(255,255,255,0.05); border-radius: 50%; top: -250px; right: -250px;"></div>
    <div style="position: absolute; width: 300px; height: 300px; background: rgba(255,255,255,0.03); border-radius: 50%; bottom: -150px; left: -150px;"></div>
    
    <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 40px 20px; position: relative; z-index: 1;">
        <div style="width: 100%; max-width: 480px; background: white; border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 48px; animation: slideUp 0.5s ease-out;">
            
            <!-- Logo & Branding -->
            <div style="text-align: center; margin-bottom: 40px;">
                <img src="images/finsys-logo.png" alt="FINSYS Logo" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin: 0 auto 20px; box-shadow: 0 8px 24px rgba(16,185,129,0.3); border: 4px solid #10b981;" />
                <h1 style="font-size: 32px; font-weight: 800; color: #0f766e; margin-bottom: 8px; letter-spacing: -0.5px;">FINSYS</h1>
                <p style="font-size: 14px; color: #6b7280; margin-bottom: 4px;">Finance Account and Banking Transaction System</p>
                <div style="display: inline-flex; align-items: center; gap: 6px; background: #d1fae5; padding: 6px 16px; border-radius: 20px; margin-top: 12px;">
                    <span style="font-size: 12px; color: #065f46; font-weight: 600;">üîí 256-BIT ENCRYPTED</span>
                </div>
            </div>

            <div style="text-align: center; margin-bottom: 32px;">
                <h2 style="font-size: 24px; font-weight: 700; color: #111827; margin-bottom: 8px;">Welcome Back!</h2>
                <p style="font-size: 14px; color: #6b7280;">Enter your credentials to access your account</p>
            </div>

        <form @onsubmit="HandleLogin">
            <div class="form-group">
                <label class="form-label required-field">Username or Email</label>
                <div class="input-icon">
                    <span class="input-icon-symbol">‚óè</span>
                    <input type="text" 
                           class="form-control @(showError && string.IsNullOrEmpty(username) ? "error" : "")" 
                           @bind="username" 
                           placeholder="Enter your username or email" 
                           @oninput="() => showError = false" />
                </div>
                @if (showError && string.IsNullOrEmpty(username))
                {
                    <span class="form-error">! Username is required</span>
                }
                <span class="form-help">Use your registered username or email address</span>
            </div>

            <div class="form-group">
                <label class="form-label required-field">Password</label>
                <div class="input-icon">
                    <span class="input-icon-symbol">‚óÜ</span>
                    <input type="@(showPassword ? "text" : "password")" 
                           class="form-control @(showError && string.IsNullOrEmpty(password) ? "error" : "")" 
                           @bind="password" 
                           placeholder="Enter your password" 
                           @oninput="() => showError = false" />
                </div>
                @if (showError && string.IsNullOrEmpty(password))
                {
                    <span class="form-error">! Password is required</span>
                }
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                    <label style="font-size: 12px; display: flex; align-items: center; gap: 4px; cursor: pointer;">
                        <input type="checkbox" @onchange="() => showPassword = !showPassword" />
                        Show password
                    </label>
                    <a href="/forgot-password" style="font-size: 12px; color: var(--accent); text-decoration: none;">Forgot password?</a>
                </div>
            </div>

            <!-- Role Selection -->
            <div class="form-group">
                <label class="form-label required-field">Select Role</label>
                <select class="form-control @(showError && string.IsNullOrEmpty(role) ? "error" : "")" @bind="role" style="padding: 14px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 15px;">
                    <option value="">Choose your role</option>
                    <option value="@AuthService.Roles.Customer">üë§ Customer - Personal Banking</option>
                    <option value="@AuthService.Roles.Accountant">üìä Accountant - Banking & Accounting</option>
                    <option value="@AuthService.Roles.FinanceManager">üíµ Finance Manager - Financial Management</option>
                    <option value="@AuthService.Roles.SuperAdmin">üîê Super Administrator - Full Access</option>
                </select>
                @if (showError && string.IsNullOrEmpty(role))
                {
                    <span class="form-error" style="color: #dc2626; font-size: 13px; margin-top: 4px; display: block;">! Please select your role</span>
                }
            </div>

            <!-- Remember Me -->
            <div style="margin-bottom: 24px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 14px; color: #374151;">
                    <input type="checkbox" @bind="rememberMe" style="width: 18px; height: 18px; accent-color: #10b981; cursor: pointer;" />
                    <span>Remember me for 30 days</span>
                </label>
            </div>

            @if (!string.IsNullOrEmpty(errorMessage))
            {
                <div style="padding: 12px; background: #fee2e2; border: 1px solid #fecaca; border-radius: 8px; color: #991b1b; font-size: 13px; display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                    <span style="font-size: 18px; font-weight: bold;">!</span>
                    <div>
                        <strong>Login Failed</strong><br />
                        <span>@errorMessage</span>
                    </div>
                </div>
            }

            @if (isLoading)
            {
                <div style="padding: 12px; background: var(--primary-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--accent); font-size: 13px; display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                    <span style="font-size: 18px;">‚Ä¢‚Ä¢‚Ä¢</span>
                    <span>Authenticating your credentials...</span>
                </div>
            }

            <button type="submit" style="width: 100%; padding: 16px; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(16,185,129,0.3);" disabled="@isLoading" @onclick:preventDefault @onclick="HandleLogin">
                @if (isLoading)
                {
                    <span style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span style="width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite;"></span>
                        Authenticating...
                    </span>
                }
                else
                {
                    <span style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span>üîì</span> Sign In Securely
                    </span>
                }
            </button>
        </form>

            <!-- Additional Links -->
            <div style="text-align: center; margin-top: 32px; padding-top: 24px; border-top: 1px solid #e5e7eb;">
                <p style="font-size: 13px; color: #6b7280; margin-bottom: 16px;">Need help accessing your account?</p>
                <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                    <a href="#" style="font-size: 13px; color: #10b981; text-decoration: none; font-weight: 600;">üìû Contact Support</a>
                    <a href="#" style="font-size: 13px; color: #10b981; text-decoration: none; font-weight: 600;">‚ùì Help Center</a>
                </div>
                <div style="margin-top: 20px; padding: 12px; background: #f9fafb; border-radius: 8px;">
                    <p style="font-size: 12px; color: #6b7280; margin: 0;">
                        üîê New user registration is managed by System Administrator only
                    </p>
                </div>
            </div>

            <!-- Footer -->
            <div style="text-align: center; margin-top: 32px;">
                <p style="font-size: 11px; color: #9ca3af;">¬© 2025 FINSYS ERP. All rights reserved.</p>
                <p style="font-size: 11px; color: #9ca3af; margin-top: 4px;">Protected by industry-standard security protocols</p>
            </div>
        </div>
    </div>
</div>

<style>
    @@keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @@keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    .form-control {
        transition: all 0.3s;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #10b981 !important;
        box-shadow: 0 0 0 3px rgba(16,185,129,0.1) !important;
    }
    
    button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(16,185,129,0.4) !important;
    }
    
    button:active:not(:disabled) {
        transform: translateY(0);
    }
</style>

@code {
    private string username = "";
    private string password = "";
    private string role = "";
    private string errorMessage = "";
    private bool showError = false;
    private bool showPassword = false;
    private bool isLoading = false;
    private bool rememberMe = false;

    private async Task HandleLogin()
    {
        showError = true;
        errorMessage = "";

        // Validation with clear error messages
        if (string.IsNullOrEmpty(username))
        {
            errorMessage = "Username or email is required";
            return;
        }

        if (string.IsNullOrEmpty(password))
        {
            errorMessage = "Password is required";
            return;
        }

        if (string.IsNullOrEmpty(role))
        {
            errorMessage = "Please select your role";
            return;
        }

        // Simulate loading state (UI feedback)
        isLoading = true;
        await Task.Delay(1000); // Simulate API call

        // Simulate login validation
        if (password.Length < 6)
        {
            errorMessage = "Invalid credentials. Please check your username and password.";
            isLoading = false;
            return;
        }

        // Successful login
        AuthService.Login(username, role);
        isLoading = false;

        // Log the login attempt
        // TODO: Implement actual IP tracking and login history
        
        // Navigate based on role with clear feedback
        if (role == AuthService.Roles.Customer)
        {
            Navigation.NavigateTo("/customer/dashboard");
        }
        else
        {
            // SuperAdmin, Accountant, Finance Manager go to admin dashboard
            Navigation.NavigateTo("/admin/dashboard");
        }
    }
}
