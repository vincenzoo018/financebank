@page "/customer/transactions"
@layout CustomerLayout

<div style="padding: 24px; max-width: 1200px; margin: 0 auto;">
    <!-- Header -->
    <div style="background: linear-gradient(135deg, #0891b2, #0e7490); border-radius: 16px; padding: 24px; margin-bottom: 24px; color: white;">
        <div style="display: flex; align-items: center; gap: 16px;">
            <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 3h18v18H3z"/>
                    <path d="M3 9h18"/>
                    <path d="M9 3v18"/>
                </svg>
            </div>
            <div style="flex: 1;">
                <h1 style="font-size: 28px; font-weight: 700; margin: 0;">All Transactions</h1>
                <p style="margin: 4px 0 0; opacity: 0.9; font-size: 16px;">View and filter your transaction history</p>
            </div>
            <button @onclick="ShowFilters" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
                    <path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"/>
                </svg>
                Filters
            </button>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 250px 1fr; gap: 24px;">
        <!-- Sidebar -->
        <div style="display: flex; flex-direction: column; gap: 16px;">
            <!-- Filter by Type -->
            <div style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <h3 style="font-size: 16px; font-weight: 600; color: #1f2937; margin-bottom: 16px;">Filter by Type</h3>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    @foreach (var type in filterTypes)
                    {
                        <button @onclick="() => selectedFilter = type" style="padding: 10px 12px; background: @(selectedFilter == type ? "#e0f2fe" : "transparent"); border: none; border-radius: 8px; text-align: left; cursor: pointer; font-weight: @(selectedFilter == type ? "600" : "400"); color: @(selectedFilter == type ? "#0891b2" : "#1f2937"); transition: all 0.2s;">
                            @type
                        </button>
                    }
                </div>
            </div>

            <!-- Summary -->
            <div style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <h3 style="font-size: 16px; font-weight: 600; color: #1f2937; margin-bottom: 16px;">This Month</h3>
                <div style="margin-bottom: 12px;">
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Income</div>
                    <div style="font-size: 20px; font-weight: 700; color: #059669;">+₱@CalculateIncome().ToString("N2")</div>
                </div>
                <div>
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Expenses</div>
                    <div style="font-size: 20px; font-weight: 700; color: #dc2626;">-₱@CalculateExpenses().ToString("N2")</div>
                </div>
            </div>
        </div>

        <!-- Transactions List -->
        <div style="background: white; border-radius: 16px; padding: 28px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
            <h2 style="font-size: 20px; font-weight: 600; color: #1f2937; margin-bottom: 24px;">Transaction History</h2>
            <div style="display: flex; flex-direction: column; gap: 12px;">
                @foreach (var transaction in GetFilteredTransactions())
                {
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: #f9fafb; border-radius: 12px; cursor: pointer; transition: all 0.2s;" class="transaction-row" @onclick="() => ShowTransactionDetails(transaction)">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div style="width: 48px; height: 48px; background: @(transaction.Amount >= 0 ? "linear-gradient(135deg, #d1fae5, #a7f3d0)" : "linear-gradient(135deg, #fee2e2, #fecaca)"); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="@(transaction.Amount >= 0 ? "#059669" : "#dc2626")" stroke-width="2">
                                    @if (transaction.Category == "Deposit" || transaction.Category == "Income")
                                    {
                                        <path d="M12 5v14M5 12l7 7 7-7"/>
                                    }
                                    else if (transaction.Category == "Transfer")
                                    {
                                        <path d="M5 12h14M12 5l7 7-7 7"/>
                                    }
                                    else if (transaction.Category == "Bills")
                                    {
                                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                                        <path d="M3 9h18"/>
                                    }
                                    else
                                    {
                                        <path d="M12 19V5M5 12l7-7 7 7"/>
                                    }
                                </svg>
                            </div>
                            <div>
                                <div style="font-weight: 600; color: #1f2937; font-size: 15px;">@transaction.Title</div>
                                <div style="font-size: 13px; color: #6b7280; margin-top: 2px;">@transaction.Date.ToString("MMM dd, yyyy - hh:mm tt")</div>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 700; font-size: 16px; color: @(transaction.Amount >= 0 ? "#059669" : "#dc2626");">
                                @(transaction.Amount >= 0 ? "+" : "")₱@Math.Abs(transaction.Amount).ToString("N2")
                            </div>
                            <div style="font-size: 12px; color: #6b7280; margin-top: 2px;">@transaction.Status</div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Transaction Details Modal -->
@if (selectedTransaction != null)
{
    <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;" @onclick="CloseDetails">
        <div style="background: white; border-radius: 16px; padding: 32px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);" @onclick:stopPropagation="true">
            <h2 style="font-size: 24px; font-weight: 700; color: #1f2937; margin-bottom: 24px;">Transaction Details</h2>
            
            <div style="display: flex; flex-direction: column; gap: 16px;">
                <div>
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Transaction ID</div>
                    <div style="font-size: 14px; font-weight: 600; color: #1f2937;">@selectedTransaction.Id</div>
                </div>
                <div>
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Description</div>
                    <div style="font-size: 14px; font-weight: 600; color: #1f2937;">@selectedTransaction.Title</div>
                </div>
                <div>
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Date & Time</div>
                    <div style="font-size: 14px; font-weight: 600; color: #1f2937;">@selectedTransaction.Date.ToString("MMMM dd, yyyy - hh:mm:ss tt")</div>
                </div>
                <div>
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Amount</div>
                    <div style="font-size: 24px; font-weight: 700; color: @(selectedTransaction.Amount >= 0 ? "#059669" : "#dc2626");">
                        @(selectedTransaction.Amount >= 0 ? "+" : "")₱@Math.Abs(selectedTransaction.Amount).ToString("N2")
                    </div>
                </div>
                <div>
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Status</div>
                    <div style="padding: 8px 16px; background: #d1fae5; color: #065f46; border-radius: 8px; display: inline-block; font-size: 14px; font-weight: 600;">@selectedTransaction.Status</div>
                </div>
            </div>

            <button @onclick="CloseDetails" style="width: 100%; margin-top: 24px; padding: 14px; background: linear-gradient(135deg, #0891b2, #0e7490); border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 600; cursor: pointer;">
                Close
            </button>
        </div>
    </div>
}

<style>
    .transaction-row:hover {
        background: #e0f2fe !important;
        transform: translateX(4px);
    }
</style>

@code {
    private List<Transaction> transactions = new();
    private List<string> filterTypes = new() { "All", "Income", "Expenses", "Transfer", "Bills", "Deposit", "Withdrawal" };
    private string selectedFilter = "All";
    private Transaction? selectedTransaction;

    protected override void OnInitialized()
    {
        transactions = new List<Transaction>
        {
            new() { Id = "TXN001", Title = "Salary Deposit", Category = "Deposit", Date = DateTime.Now, Amount = 15000, Status = "Completed" },
            new() { Id = "TXN002", Title = "Shopping - Grocery Store", Category = "Expenses", Date = DateTime.Now.AddHours(-2), Amount = -1250.50m, Status = "Completed" },
            new() { Id = "TXN003", Title = "Electric Bill Payment", Category = "Bills", Date = DateTime.Now.AddDays(-1), Amount = -850, Status = "Completed" },
            new() { Id = "TXN004", Title = "Mobile Load", Category = "Bills", Date = DateTime.Now.AddDays(-1), Amount = -100, Status = "Completed" },
            new() { Id = "TXN005", Title = "Food Delivery", Category = "Expenses", Date = DateTime.Now.AddDays(-2), Amount = -450, Status = "Completed" },
            new() { Id = "TXN006", Title = "Online Shopping", Category = "Expenses", Date = DateTime.Now.AddDays(-3), Amount = -2300, Status = "Completed" },
            new() { Id = "TXN007", Title = "Ride Fare", Category = "Expenses", Date = DateTime.Now.AddDays(-3), Amount = -150, Status = "Completed" },
            new() { Id = "TXN008", Title = "Freelance Income", Category = "Income", Date = DateTime.Now.AddDays(-4), Amount = 8500, Status = "Completed" },
            new() { Id = "TXN009", Title = "Transfer to Savings", Category = "Transfer", Date = DateTime.Now.AddDays(-5), Amount = -2000, Status = "Completed" },
            new() { Id = "TXN010", Title = "Cash Withdrawal", Category = "Withdrawal", Date = DateTime.Now.AddDays(-6), Amount = -5000, Status = "Completed" },
        };
    }

    private void ShowFilters()
    {
        // Toggle filters visibility
    }

    private List<Transaction> GetFilteredTransactions()
    {
        if (selectedFilter == "All") return transactions;
        return transactions.Where(t => t.Category == selectedFilter).ToList();
    }

    private decimal CalculateIncome()
    {
        return transactions.Where(t => t.Amount > 0 && t.Date.Month == DateTime.Now.Month).Sum(t => t.Amount);
    }

    private decimal CalculateExpenses()
    {
        return Math.Abs(transactions.Where(t => t.Amount < 0 && t.Date.Month == DateTime.Now.Month).Sum(t => t.Amount));
    }

    private void ShowTransactionDetails(Transaction transaction)
    {
        selectedTransaction = transaction;
    }

    private void CloseDetails()
    {
        selectedTransaction = null;
    }

    public class Transaction
    {
        public string Id { get; set; } = "";
        public string Title { get; set; } = "";
        public string Category { get; set; } = "";
        public DateTime Date { get; set; }
        public decimal Amount { get; set; }
        public string Status { get; set; } = "";
    }
}
