@page "/customer/withdraw"
@layout CustomerLayout

<div style="padding: 24px; max-width: 1200px; margin: 0 auto;">
    <!-- Header -->
    <div style="background: linear-gradient(135deg, #dc2626, #991b1b); border-radius: 16px; padding: 24px; margin-bottom: 24px; color: white;">
        <div style="display: flex; align-items: center; gap: 16px;">
            <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <span style="font-size: 32px;">üí∏</span>
            </div>
            <div>
                <h1 style="font-size: 28px; font-weight: 700; margin: 0;">Withdraw Money</h1>
                <p style="margin: 4px 0 0; opacity: 0.9; font-size: 16px;">Withdraw funds from your account</p>
            </div>
            <div style="margin-left: auto; text-align: right;">
                <button type="button" @onclick="ShowHistory" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 12px 20px; border-radius: 8px; cursor: pointer;">
                    üìä History
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">

        <!-- Withdraw Form -->
        <div style="background: white; border-radius: 16px; padding: 32px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
            <form>
                <!-- Withdrawal Method -->
                <div style="margin-bottom: 24px;">
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #1f2937;">Withdrawal Method</h3>
                    <select class="form-control" @bind="withdrawalMethod" style="font-size: 16px; padding: 12px;">
                        <option value="atm">üèß ATM Withdrawal</option>
                        <option value="teller">üí∞ Over-the-Counter</option>
                        <option value="online">üåê Online Transfer</option>
                    </select>
                </div>

                <!-- From Account -->
                <div style="margin-bottom: 24px;">
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #1f2937;">From Account</h3>
                    <div style="border: 2px solid #e5e7eb; border-radius: 12px; padding: 16px; background: #f9fafb;">
                        <div style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">FINSYS Savings Account</div>
                        <div style="font-size: 16px; font-weight: 600; color: #1f2937; margin-bottom: 4px;">****1234</div>
                        <div style="font-size: 20px; font-weight: 700; color: #059669;">‚Ç±25,450.75</div>
                        <div style="font-size: 12px; color: #6b7280; margin-top: 4px;">Available Balance</div>
                    </div>
                </div>

                <!-- Amount -->
                <div style="margin-bottom: 24px;">
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #1f2937;">Withdrawal Amount</h3>
                    <div class="form-group">
                        <input type="number" class="form-control" @bind="amount" placeholder="0.00" style="font-size: 24px; font-weight: 600; padding: 16px; text-align: center; color: #dc2626;" />
                        <div style="text-align: center; margin-top: 8px; font-size: 14px; color: #6b7280;">Withdrawal Fee: ‚Ç±15.00</div>
                    </div>

                    <!-- Daily Limit Info -->
                    <div style="background: #fef3c7; border: 1px solid #fcd34d; border-radius: 8px; padding: 16px; margin-top: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-size: 14px; font-weight: 600; color: #92400e;">Daily Withdrawal Limit</span>
                            <span style="font-size: 16px; font-weight: 700; color: #92400e;">‚Ç±50,000.00</span>
                        </div>
                        <div style="font-size: 12px; color: #92400e;">Used today: ‚Ç±5,000.00 | Remaining: ‚Ç±45,000.00</div>
                    </div>
                </div>

                <!-- Purpose -->
                <div style="margin-bottom: 32px;">
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #1f2937;">Purpose</h3>
                    <select class="form-control" @bind="purpose" style="margin-bottom: 12px;">
                        <option value="personal">üë§ Personal Use</option>
                        <option value="shopping">üõçÔ∏è Shopping</option>
                        <option value="medical">üè• Medical Expenses</option>
                        <option value="business">üíº Business</option>
                        <option value="other">üìù Other</option>
                    </select>
                    @if (purpose == "other")
                    {
                        <textarea class="form-control" @bind="otherPurpose" placeholder="Please specify the purpose" rows="2" style="resize: vertical;"></textarea>
                    }
                </div>

                <!-- Action Buttons -->
                <div style="display: flex; gap: 12px;">
                    <button type="button" @onclick="ClearForm" style="flex: 1; padding: 16px; background: #f3f4f6; border: none; border-radius: 12px; color: #374151; font-size: 16px; font-weight: 600; cursor: pointer;">
                        Clear
                    </button>
                    <button type="button" @onclick="ProcessWithdrawal" style="flex: 2; padding: 16px; background: linear-gradient(135deg, #dc2626, #991b1b); border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 600; cursor: pointer;">
                        Withdraw Now ‚Üí
                    </button>
                </div>
            </form>
        </div>

        <!-- Sidebar -->
        <div>
            <!-- Quick Actions -->
            <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 24px;">
                <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #1f2937;">Quick Actions</h3>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <button type="button" style="padding: 12px 16px; background: #eff6ff; border: 1px solid #3b82f6; border-radius: 8px; color: #1e40af; font-weight: 500; cursor: pointer; text-align: left;">
                        üí∏ Transfer Money
                    </button>
                    <button type="button" style="padding: 12px 16px; background: #f0fdf4; border: 1px solid #10b981; border-radius: 8px; color: #065f46; font-weight: 500; cursor: pointer; text-align: left;">
                        üí∞ Deposit Money
                    </button>
                    <button type="button" style="padding: 12px 16px; background: #f0fdf4; border: 1px solid #10b981; border-radius: 8px; color: #065f46; font-weight: 500; cursor: pointer; text-align: left;">
                        üìÑ Pay Bills
                    </button>
                </div>
            </div>

            <!-- Recent Withdrawals -->
            <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h3 style="font-size: 18px; font-weight: 600; color: #1f2937;">Recent Withdrawals</h3>
                    <button type="button" @onclick="ShowHistory" style="font-size: 14px; color: #dc2626; background: none; border: none; cursor: pointer; font-weight: 500;">View All</button>
                </div>
                
                @foreach (var withdrawal in recentWithdrawals.Take(3))
                {
                    <div class="withdrawal-item" style="padding: 12px; border-radius: 8px; border: 1px solid #e5e7eb; margin-bottom: 8px; cursor: pointer; transition: all 0.2s;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <div style="font-weight: 600; font-size: 14px; color: #1f2937;">@withdrawal.Method</div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 2px;">@withdrawal.Date.ToString("MMM dd, yyyy")</div>
                            </div>
                            <div style="font-weight: 600; color: #dc2626;">-‚Ç±@withdrawal.Amount.ToString("N2")</div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<style>
    .withdrawal-item:hover {
        background: #fef2f2;
        border-color: #dc2626;
    }
</style>

<!-- Transaction History Modal -->
@if (showHistoryModal)
{
    <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;" @onclick="CloseHistory">
        <div style="background: white; border-radius: 16px; padding: 32px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);" @onclick:stopPropagation="true">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h2 style="font-size: 24px; font-weight: 700; color: #1f2937;">Withdrawal History</h2>
                <button @onclick="CloseHistory" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">&times;</button>
            </div>
            
            <div>
                @foreach (var withdrawal in recentWithdrawals)
                {
                    <div style="border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <span style="font-size: 20px;">üí∏</span>
                                    <div>
                                        <div style="font-weight: 600; color: #1f2937;">@withdrawal.Method</div>
                                        <div style="font-size: 12px; color: #6b7280;">@withdrawal.Reference</div>
                                    </div>
                                </div>
                                <div style="font-size: 14px; color: #6b7280;">@withdrawal.Purpose</div>
                                <div style="font-size: 12px; color: #9ca3af; margin-top: 4px;">@withdrawal.Date.ToString("MMM dd, yyyy hh:mm tt")</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: 700; font-size: 18px; color: #dc2626;">-‚Ç±@withdrawal.Amount.ToString("N2")</div>
                                <div style="font-size: 12px; margin-top: 4px;">
                                    <span style="padding: 4px 8px; background: @(withdrawal.Status == "Completed" ? "#d1fae5" : "#fef3c7"); color: @(withdrawal.Status == "Completed" ? "#065f46" : "#92400e"); border-radius: 4px; font-weight: 500;">@withdrawal.Status</span>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
}

@code {
    private string withdrawalMethod = "atm";
    private decimal amount = 0;
    private string purpose = "personal";
    private string otherPurpose = "";
    private bool showHistoryModal = false;

    private List<WithdrawalHistory> recentWithdrawals = new();

    protected override void OnInitialized()
    {
        recentWithdrawals = new List<WithdrawalHistory>
        {
            new() { Method = "ATM Withdrawal", Reference = "WDR-001", Amount = 3000, Purpose = "Personal expenses", Date = DateTime.Now.AddHours(-1), Status = "Completed" },
            new() { Method = "Over-the-Counter", Reference = "WDR-002", Amount = 5000, Purpose = "Shopping", Date = DateTime.Now.AddDays(-1), Status = "Completed" },
            new() { Method = "ATM Withdrawal", Reference = "WDR-003", Amount = 2000, Purpose = "Emergency", Date = DateTime.Now.AddDays(-2), Status = "Completed" },
            new() { Method = "Online Transfer", Reference = "WDR-004", Amount = 1000, Purpose = "Bills payment", Date = DateTime.Now.AddDays(-3), Status = "Pending" },
            new() { Method = "ATM Withdrawal", Reference = "WDR-005", Amount = 4000, Purpose = "Medical expenses", Date = DateTime.Now.AddDays(-4), Status = "Completed" }
        };
    }

    private void ShowHistory()
    {
        showHistoryModal = true;
    }

    private void CloseHistory()
    {
        showHistoryModal = false;
    }

    private void ClearForm()
    {
        withdrawalMethod = "atm";
        amount = 0;
        purpose = "personal";
        otherPurpose = "";
    }

    private void ProcessWithdrawal()
    {
        // Implement logic to process the withdrawal
        // Add validation and actual withdrawal logic here
    }

    public class WithdrawalHistory
    {
        public string Method { get; set; } = "";
        public string Reference { get; set; } = "";
        public decimal Amount { get; set; }
        public string Purpose { get; set; } = "";
        public DateTime Date { get; set; }
        public string Status { get; set; } = "";
    }
}
